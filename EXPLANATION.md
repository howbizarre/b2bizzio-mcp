# Обяснение за Model Context Protocol (MCP) и нашия сървър

## Какво е Model Context Protocol (MCP)?

**Model Context Protocol (MCP)** е отворен стандарт, който позволява на AI приложения (като Claude Desktop, VS Code с AI разширения) да се свързват с външни източници на данни и инструменти по сигурен и стандартизиран начин.

### За какво се използва MCP?

1. **Разширяване на AI възможностите** - AI моделите могат да достъпват реални данни и да изпълняват действия
2. **Интеграция с външни системи** - Свързване с бази данни, API-та, файлови системи
3. **Персонализиране на AI** - Предоставяне на специфичен контекст и инструменти за различни бизнеси
4. **Сигурност** - Контролиран достъп до ресурси с одобрение от потребителя

### Как работи MCP?

```
┌─────────────────┐    MCP Protocol    ┌─────────────────┐
│   AI Клиент     │ ←──────────────→   │   MCP Сървър    │
│ (Claude Desktop)│                    │ (Нашия сървър)  │
└─────────────────┘                    └─────────────────┘
```

AI клиентът (като Claude) се свързва с нашия MCP сървър и може да:
- Вижда какви инструменти (tools) предлагаме
- Достъпва ресурси (resources) 
- Използва готови подкани (prompts)

---

## Основни понятия в MCP

### 1. **Tools (Инструменти)**
**Какво са:** Функции, които AI може да извиква за изпълнение на действия

**За какво се използват:**
- Търсене в бази данни
- Изпращане на имейли
- Калкулации
- API заявки
- Всякакви операции, които искаме AI да може да прави

**Пример от живота:** Като да дадеш на AI калкулатор - той може да натисне бутоните, но ти решаваш дали да му позволиш

### 2. **Resources (Ресурси)**
**Какво са:** Данни или файлове, които AI може да чете

**За какво се използват:**
- Четене на документи
- Достъп до конфигурации
- Споделени данни
- Статична информация

**Пример от живота:** Като библиотека - AI може да чете книгите, но не може да ги променя

### 3. **Prompts (Подкани)**
**Какво са:** Готови шаблони за въпроси или инструкции към AI

**За какво се използват:**
- Стандартизирани анализи
- Готови формати за отговори
- Комплексни инструкции
- Повтарящи се задачи

**Пример от живота:** Като готови формуляри - AI знае какво да попита и как да форматира отговора

---

## Обяснение на нашия код (src/index.ts)

### Начално настройване

```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";
```

**Какво правим тук:**
- Импортираме MCP SDK за създаване на сървър
- Импортираме транспорт за комуникация (STDIO = чрез входа/изхода на програмата)
- Импортираме Zod за валидация на данни (проверка дали входните данни са правилни)

```typescript
const server = new McpServer({
  name: "b2bizzio-mcp-server",
  version: "1.0.0"
});
```

**Какво правим тук:**
- Създаваме нашия MCP сървър с име и версия
- Това е като да отваряме магазин и слагаме табела с името му

### Дефиниране на схеми за валидация

```typescript
const GetInfoArgsSchema = {
  topic: z.string().describe("The topic to get information about")
};

const EchoArgsSchema = {
  message: z.string().describe("The message to echo back")
};
```

**Какво правим тук:**
- Дефинираме какви данни очакваме от AI когато използва нашите инструменти
- Като правила: "за get_info трябва да дадеш topic като текст"
- Това е като меню в ресторант - казваме какво може да се поръча

---

## Нашите Tools (Инструменти)

### Tool 1: get_info

```typescript
server.registerTool(
  "get_info",                              // Име на инструмента
  {
    description: "Get information about B2Bizzio services",  // Описание
    inputSchema: GetInfoArgsSchema          // Какви данни очакваме
  },
  async ({ topic }) => {                   // Функцията която се изпълнява
    return {
      content: [
        {
          type: "text",
          text: `Information about ${topic}: This is a sample...`
        }
      ]
    };
  }
);
```

**Какво прави:**
- AI може да пита "дай ми информация за X"
- Нашия сървър получава темата (topic)
- Връща текстов отговор с информация

**Пример на използване:**
- AI: "Използвай get_info с topic='продажби'"
- Сървър: "Information about продажби: This is a sample..."

### Tool 2: echo

```typescript
server.registerTool(
  "echo",
  {
    description: "Echo a message back to the user", 
    inputSchema: EchoArgsSchema
  },
  async ({ message }) => {
    return {
      content: [
        {
          type: "text",
          text: `Echo: ${message}`
        }
      ]
    };
  }
);
```

**Какво прави:**
- Получава съобщение и го връща обратно с "Echo: " отпред
- Като ехо в планината - повтаря това което чуе

**Пример на използване:**
- AI: "Използвай echo с message='Здравей!'"
- Сървър: "Echo: Здравей!"

---

## Нашия Resource (Ресурс)

```typescript
server.registerResource(
  "welcome",                               // Име на ресурса
  "b2bizzio://welcome",                   // URI адрес
  {
    description: "Welcome message for B2Bizzio MCP server",
    mimeType: "text/plain"                // Тип на съдържанието
  },
  async () => {                           // Функция която връща данните
    return {
      contents: [
        {
          uri: "b2bizzio://welcome",
          mimeType: "text/plain",
          text: "Welcome to B2Bizzio MCP Server!..."
        }
      ]
    };
  }
);
```

**Какво прави:**
- Предоставя приветствено съобщение което AI може да прочете
- Като статична уеб страница - съдържанието не се променя
- AI може да каже "покажи ми welcome ресурса"

**Пример на използване:**
- AI чете ресурса и вижда информация за нашия сървър
- Може да използва тази информация в разговори с потребители

---

## Нашия Prompt (Подкана)

```typescript
server.prompt(
  "business_analysis",                     // Име на подканата
  "Generate a business analysis prompt",   // Описание
  {
    company: z.string().describe("The company name to analyze")  // Параметри
  },
  async ({ company }, extra) => {          // Функция която генерира подканата
    return {
      description: `Business analysis prompt for ${company}`,
      messages: [
        {
          role: "user",
          content: {
            type: "text",
            text: `Please provide a comprehensive business analysis for ${company}...`
          }
        }
      ]
    };
  }
);
```

**Какво прави:**
- Създава готов шаблон за бизнес анализ
- AI може да каже "използвай business_analysis подканата за компания X"
- Генерира структурирана заявка за анализ

**Пример на използване:**
- Потребител: "Анализирай компания Coca-Cola"
- AI: "Използвам business_analysis подканата..."
- Резултат: Подробен структуриран анализ на Coca-Cola

---

## Стартиране на сървъра

```typescript
async function main() {
  const transport = new StdioServerTransport();  // Как ще комуникираме
  await server.connect(transport);               // Свързваме сървъра
  console.error("B2Bizzio MCP Server is running...");  // Съобщение
}
```

**Какво прави:**
- Стартира сървъра и го прави готов за връзки
- STDIO transport означава че комуникацията е чрез command line
- Като да отвориш магазин и да включиш светлината "ОТВОРЕНО"

### Graceful shutdown (Елегантно спиране)

```typescript
process.on('SIGINT', async () => {
  console.error("Shutting down B2Bizzio MCP Server...");
  await server.close();
  process.exit(0);
});
```

**Какво прави:**
- Когато натиснем Ctrl+C, сървърът се спира елегантно
- Затваря всички връзки преди да спре
- Като да заключиш магазина преди да си тръгнеш

---

## Практически примери за използване

### Сценарий 1: Потребител пита за информация
1. **Потребител в Claude:** "Какво можеш да ми кажеш за маркетинг?"
2. **Claude:** Използва `get_info` tool с topic="маркетинг"
3. **Нашия сървър:** Връща информация за маркетинг услугите на B2Bizzio
4. **Claude:** Представя отговора на потребителя

### Сценарий 2: Бизнес анализ
1. **Потребител:** "Направи анализ на Tesla"
2. **Claude:** Използва `business_analysis` prompt с company="Tesla"
3. **Нашия сървър:** Генерира структурирана подкана за анализ
4. **Claude:** Прави подробен анализ на Tesla използвайки шаблона

### Сценарий 3: Проверка на връзката
1. **Claude:** Използва `echo` tool с message="test"
2. **Нашия сървър:** Връща "Echo: test"
3. **Claude:** Знае че връзката работи правилно

---

## Защо е важно това?

1. **Разширяемост:** Можем да добавим повече tools за реални B2Bizzio услуги
2. **Интеграция:** Claude може да достъпва наши данни и системи
3. **Персонализация:** AI получава специфичен контекст за нашия бизнес
4. **Контрол:** Ние определяме какво може да прави AI
5. **Сигурност:** Всяко действие изисква одобрение

---

## Следващи стъпки за разширение

Можем да добавим:
- **Database tools:** За търсене в клиентски бази данни
- **Email tools:** За изпращане на офертите
- **Analytics tools:** За бизнес метрики
- **CRM integration:** За работа с клиенти
- **Report generation:** За автоматични отчети

Този MCP сървър е основата - като фундамент на сграда. Върху него можем да градим колкото искаме функционалности!
